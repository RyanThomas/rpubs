---
title: "Housing Permits and New House Value"
author: "Ryan Thomas"
date: "December 30, 2015"
output: html_document
---

What is the relationship of new housing permits and the price for new housing? Are places with the highest number of permits also having the highest new housing value? This study will use 2014 census data to examine the relationship between new housing units permits and the value of new housing units.
```{r, echo=FALSE}
setwd("~/Documents/r/directories/data")

permits <- read.table("~/Documents/r/directories/data/permitsByMSA2014.txt", sep = "\t", header = TRUE)

str(permits)
```

```{r}
plot(permits$TotalV/1000,permits$TotalN, 
     pch = 16,
     cex = .5,
     xlab = "Total Permit Value Thousands", 
     ylab = "Total Number of Permits", 
     main = "Number of Permits by Value")
```


Now, to find the perunit value of a unit in each type of housing, we will divide the value of housing permits for each type of building by the number of units.
```{r}
one <- permits$OneV/permits$OneN
two <- permits$TwoV/(permits$TwoN*2)
three <- permits$ThreeFourV/(permits$ThreeFourN*3.5)
five <- permits$FiveMoreV/(permits$FiveMoreN*6)
total <- permits$TotalV/permits$TotalN

perunit <- data.frame(cbind(one, two, three, five))
colnames(perunit) <- c("one", "two", "three", "five")
str(perunit)

permits$single <- perunit$one
permits$multi <- apply(perunit[,2:4], 1, mean, na.rm = TRUE)
permits$perunit <- apply(perunit, 1, mean, na.rm = TRUE)
summary(permits$single)
summary(permits$multi)
```

What is the relationship between the total number of permits and the perunit value?
```{r}
plot(permits$single,permits$TotalN, 
     pch = 16, 
     xlab = "Per Unit Permit Value (Thousands)", 
     ylab = "Total Number of Permits", 
     main = "Number of Permits by Value Per Unit")
points(permits$multi,permits$TotalN, 
     pch = 16,
     col = "grey")
fit <- glm(permits$perunit~permits$TotalN)
co <- coef(fit)
abline(fit, col="blue", lwd=2)
```

```{r}
hist(permits$perunit, 20, 
     col = "grey", 
     main = "Histogram of Mean Price per Unit", 
     xlab = "Price per Unit (Thousands)", 
     axes = TRUE, 
     plot = TRUE)
 abline(v = mean(permits$perunit),col = "red")
```

Compare this to the median income to find out whether the average price per unit is affordable. #Need to incorporate data on median income.

```{r}
permits <- cbind(permits, one, two, three, five)

par(mfrow = c(1,2),
    main = "Number of Permits by Value Per Unit")
hist(permits$single, breaks = seq(from = 0, to = 1500, by = 50), 
     xlim = c(0,500),
     ylim = c(0,300),
     xlab = "Value Per Unit",
     main = "Single Units",
     col = "grey")
   abline(v = mean(permits$perunit),col = "red")
   abline(v = mean(permits$one, na.rm = TRUE),col = "black")

hist(permits$multi, breaks = seq(from = 0, to = 1500, by = 50), 
     xlim = c(0,500),
     ylim = c(0,300),
     xlab = "Value Per Unit", 
     main = "Multi Units",
     col = "grey")
   abline(v = mean(permits$perunit),col = "red")
   abline(v = mean(permits$two, na.rm = TRUE),col = "black")

# hist(permits$three,breaks = seq(from = 0, to = 1500, by = 50), 
#      xlim = c(0,500),
#      ylim = c(0,300),
#      xlab = "Three and Four Units", 
#      main = "")
#    abline(v = mean(permits$perunit),col = "red")
#    abline(v = mean(permits$three, na.rm = TRUE),col = "black")
# 
# hist(permits$five, breaks = seq(from = 0, to = 1500, by = 50), 
#       xlim = c(0,500),
#       ylim = c(0,300),
#       xlab = "Five and Over",
#       main = "")
#    abline(v = mean(permits$perunit),col = "red")
#    abline(v = mean(permits$five, na.rm = TRUE),col = "black")
   
```



```{r}
par(mfrow = c(2,2))
plot(glm(permits$single ~ permits$TotalN), pch = 16, col = "light grey")

par(mfrow = c(2,2))
plot(glm(permits$multi ~ permits$TotalN), pch = 16, col = "light grey")

par(mfrow = c(2,2))
plot(glm(permits$perunit ~ permits$TotalN), pch = 16, col = "light grey")
```

```{r}
perunit.single <- data.frame(permits$single)
perunit.single$type <- as.factor("Single")
colnames(perunit.single) <- c("perunit", "type")

perunit.multi <- data.frame(permits$multi)
perunit.multi$type <- as.factor("Multi")
colnames(perunit.multi) <- c("perunit", "type")

perunit.anova <- rbind(perunit.single, perunit.multi)

plot(perunit ~ type, data = perunit.anova, na.rm = TRUE, 
     notch = TRUE,
     main = "Difference in Means of Single and Multi Unit Permit Values")
```

```{r}
lm.perunit.anova <- lm(perunit.anova)
anova(lm.perunit.anova)
```

